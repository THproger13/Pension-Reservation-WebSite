<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <th:block th:replace="~{component/config :: config}"></th:block>
</head>
<body>
<h1>예약관리 화면출력</h1>

<div id="section" class="container">
    <div id="search-area" class="mt-5">
        <tr>
            <form action="/admin/reserve" method="get">

                <select name="listCount" th:if="${listCount}==3">
                    <option value="5">글 개수</option>
                    <option value="3" selected>3개씩 보기</option>
                    <option value="5">5개씩 보기</option>
                    <option value="10">10개씩 보기</option>
                </select>
                <select name="listCount" th:if="${listCount}==5">
                    <option value="5">글 개수</option>
                    <option value="3">3개씩 보기</option>
                    <option value="5" selected>5개씩 보기</option>
                    <option value="10">10개씩 보기</option>
                </select>
                <select name="listCount" th:if="${listCount}==10">
                    <option value="5">글 개수</option>
                    <option value="3">3개씩 보기</option>
                    <option value="5">5개씩 보기</option>
                    <option value="10" selected>10개씩 보기</option>
                </select>
                <select name="type" th:if="${type}==''">
                    <option value="memberName" selected>예약자명</option>
                    <option value="roomName">방이름</option>
                </select>
                <select name="type" th:if="${type}=='memberName'">
                    <option value="memberName" selected>예약자명</option>
                    <option value="roomName">방이름</option>
                </select>
                <select name="type" th:if="${type}=='roomName'">
                    <option value="memberName">예약자명</option>
                    <option value="roomName" selected>방이름</option>
                </select>
                <input id="q" type="text" name="q" placeholder="검색어를 입력하세요">
                <input type="date" name="checkInDate" th:value="${checkInDate}">
                <input type="submit" value="검색">
            </form>
        </tr>
    </div>
    <table class="table table-hover text-center">
        <tr>
            <td>예약 번호</td>
            <td>회원 이름</td>
            <td>방 이름</td>
            <td>결제 가격</td>
            <td>수용인원</td>
            <td>체크인 일자</td>
            <td>체크아웃 일자</td>
            <td>예약진행상태</td>
        </tr>


        <tr th:each="reserve : ${memberReserveList}">
            <td th:text="${reserve.id}"></td>
            <td th:text="${reserve.memberName}"></td>
            <td th:text="${reserve.roomName}"></td>
            <td th:text="${reserve.totalPrice}"></td>
            <td th:text="${reserve.persons}"></td>
            <td th:text="${reserve.checkInDate}"></td>
            <td th:text="${reserve.checkOutDate}"></td>

            <td th:if="${reserve.status} == 0">
                <form action="/admin/reserve" method="post">
                    <input type="hidden" name="id" th:value="${reserve.id}">
                    <input class="btn btn-outline-danger" type="submit" value="예약취소승인">
                </form>
            </td>

            <td th:if="${reserve.status} == 1" th:text="결제완료"></td>
        </tr>
    </table>
</div>

<div class="container">
    <ul class="pagination justify-content-center" id="page">
        <li class="page-item">
            <!--첫페이지 요청 링크 /board?page=1 -->
            <a class="page-link"
               th:href="@{/admin/reserve(page=1, q=${q}, type=${type}, listCount=${listCount}, checkInDate= ${checkInDate})}">
                <span>First</span>
            </a>
        </li>

        <li th:class="${memberReserveList.first} ? 'disabled'" class="page-item">
            <!--boardList.first: isFirst()
                boardList.number: getNumber()-->
            <!-- 현재 페이지가 첫페이지라면 링크값을 #으로 아니면 /board?page=number 로  -->
            <a class="page-link"
               th:href="${memberReserveList.first} ? '#' : @{/admin/reserve(page=${memberReserveList.number}, q=${q}, type=${type}, listCount=${listCount}, checkInDate= ${checkInDate})}">
                <!-- 사용자 3페이지, number 2 /board?page=2 -->
                <span><</span> <!-- < -->
            </a>
        </li>

        <!-- startPage ~ endPage 까지 숫자를 만들어주는 역할
            for(int page=startPage; page<=endPage; page++) -->
        <li th:each="page: ${#numbers.sequence(startPage, endPage)}"
            th:class="${page == memberReserveList.number + 1} ? 'page-item active'" class="page-item">
            <a class="page-link" th:text="${page}"
               th:href="@{/admin/reserve(page=${page}, q=${q}, type=${type}, listCount=${listCount}, checkInDate= ${checkInDate})}"></a>
        </li>

        <!-- 다음 페이지 요청
            현재 3페이지를 보고 있다면 다음 페이지는 4페이지임.
            getNumber() 값은 2임.
            따라서 4페이지를 보고 싶다면 getNumber()+2를 해야 컨트롤러에 4를 요청할 수 있음. -->
        <li th:class="${memberReserveList.last} ? 'disabled'">
            <a class="page-link"
               th:href="${memberReserveList.last} ? '#' : @{/admin/reserve(page=${memberReserveList.number + 2}, q=${q}, type=${type}, listCount=${listCount}, checkInDate= ${checkInDate})}">
                <!-- 사용자 3페이지, number 2 /board?page=4 -->
                <span>&gt;</span>
            </a>
        </li>

        <li class="page-item">
            <a class="page-link"
               th:href="@{/admin/reserve(page=${memberReserveList.totalPages}, q=${q}, type=${type}, listCount=${listCount}, checkInDate= ${checkInDate})}">
                <span>Last</span>
            </a>
        </li>
    </ul>
</div>
</body>
<script th:inline="javascript">
    const reserveDelete_fn = (id) => {
        axios({
            url: `/admin/reserve/${id}`,
            method: "post"
        }).then(res => {

        }).catch()
    }
</script>
</html>